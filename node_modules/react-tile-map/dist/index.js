!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react")):"function"==typeof define&&define.amd?define(["react"],t):"object"==typeof exports?exports.TileMap=t(require("react")):e.TileMap=t(e.React)}(window,(function(e){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(t,n){t.exports=e},function(e,t,n){"use strict";var i,r="object"==typeof Reflect?Reflect:null,o=r&&"function"==typeof r.apply?r.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};i=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&y(e,"error",t,n)}(e,r,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function d(e,t,n,i){var r,o,s,a;if(c(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=l(e))>0&&s.length>r&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,a=u,console&&console.warn&&console.warn(a)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=h.bind(i);return r.listener=n,i.wrapFn=r,r}function f(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):m(r,r.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function y(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=r[e];if(void 0===u)return!1;if("function"==typeof u)o(u,this,t);else{var c=u.length,l=m(u,c);for(n=0;n<c;++n)o(l[n],this,t)}return!0},a.prototype.addListener=function(e,t){return d(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return d(this,e,t,!0)},a.prototype.once=function(e,t){return c(t),this.on(e,p(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,p(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,i,r,o,s;if(c(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},a.prototype.listenerCount=v,a.prototype.eventNames=function(){return this._eventsCount>0?i(this._events):[]}},function(e,t){var n={left:0,top:0};e.exports=function(e,t,i){t=t||e.currentTarget||e.srcElement,Array.isArray(i)||(i=[0,0]);var r=e.clientX||0,o=e.clientY||0,s=(a=t,a===window||a===document||a===document.body?n:a.getBoundingClientRect());var a;return i[0]=r-s.left,i[1]=o-s.top,i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderMap=void 0;var i=n(4);t.renderMap=function(e){var t=e.ctx,n=e.width,r=e.height,o=e.size,s=e.pan,a=e.nw,u=e.se,c=e.center,l=e.layers;t.clearRect(0,0,n,r);for(var d=n/2,h=r/2,p=0,f=l;p<f.length;p++)for(var v=f[p],m=a.x;m<u.x;m++)for(var y=u.y;y<a.y;y++){var g=(c.x-m)*o+(s?s.x:0),_=(y-c.y)*o+(s?s.y:0),w=v(m,y);if(w){var x=w.color,b=w.top,z=w.left,L=w.topLeft,E=w.scale,M=E?o*E/2:o/2;(0,i.renderTile)({ctx:t,x:d-g+M,y:h-_+M,size:o,padding:o<7?.5:o<12?1:o<18?1.5:2,offset:1,color:x,left:z,top:b,topLeft:L,scale:E})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderTile=void 0,t.renderTile=function(e){var t=e.ctx,n=e.x,i=e.y,r=e.size,o=e.padding,s=e.offset,a=e.color,u=e.left,c=e.top,l=e.topLeft,d=e.scale;t.fillStyle=a;var h=d?r*d:r;c||u?c&&u&&l?t.fillRect(n-h-s,i-h-s,h+s,h+s):(u&&t.fillRect(n-h-s,i-h+o,h+s,h-o),c&&t.fillRect(n-h+o,i-h-s,h-o,h+s)):t.fillRect(n-h+o,i-h+o,h-o,h-o)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderTile=t.renderMap=t.TileMap=void 0;var i=n(6);Object.defineProperty(t,"TileMap",{enumerable:!0,get:function(){return i.ResizableTileMap}});var r=n(3);Object.defineProperty(t,"renderMap",{enumerable:!0,get:function(){return r.renderMap}});var o=n(4);Object.defineProperty(t,"renderTile",{enumerable:!0,get:function(){return o.renderTile}})},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ResizableTileMap=void 0;var s=n(0),a=n(7),u=n(9),c=o({},u.TileMap.defaultProps);delete c.width,delete c.height;var l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.render=function(){var e=this;return s.createElement(a.default,null,(function(t){return s.createElement(u.TileMap,o({},t,e.props))}))},t.defaultProps=c,t}(s.PureComponent);t.ResizableTileMap=l},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"default",(function(){return v}));var i=n(0);function r(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o,s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{};let a;a="undefined"!=typeof window?window:"undefined"!=typeof self?self:s;let u=null,c=null;const l=a.clearTimeout,d=a.setTimeout,h=a.cancelAnimationFrame||a.mozCancelAnimationFrame||a.webkitCancelAnimationFrame,p=a.requestAnimationFrame||a.mozRequestAnimationFrame||a.webkitRequestAnimationFrame;null==h||null==p?(u=l,c=function(e){return d(e,20)}):(u=function(e){let[t,n]=e;h(t),l(n)},c=function(e){const t=p((function(){l(n),e()})),n=d((function(){h(t),e()}),20);return[t,n]}),o={createDetectElementResize:function(e){let t,n,i,r,o,s,l;const d="undefined"!=typeof document&&document.attachEvent;if(!d){s=function(e){const t=e.__resizeTriggers__,n=t.firstElementChild,i=t.lastElementChild,r=n.firstElementChild;i.scrollLeft=i.scrollWidth,i.scrollTop=i.scrollHeight,r.style.width=n.offsetWidth+1+"px",r.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},o=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},l=function(e){if(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)return;const t=this;s(this),this.__resizeRAF__&&u(this.__resizeRAF__),this.__resizeRAF__=c((function(){o(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))};let e=!1,a="";i="animationstart";const d="Webkit Moz O ms".split(" ");let h="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),p="";{const t=document.createElement("fakeelement");if(void 0!==t.style.animationName&&(e=!0),!1===e)for(let n=0;n<d.length;n++)if(void 0!==t.style[d[n]+"AnimationName"]){p=d[n],a="-"+p.toLowerCase()+"-",i=h[n],e=!0;break}}n="resizeanim",t="@"+a+"keyframes "+n+" { from { opacity: 0; } to { opacity: 0; } } ",r=a+"animation: 1ms "+n+"; "}return{addResizeListener:function(o,u){if(d)o.attachEvent("onresize",u);else{if(!o.__resizeTriggers__){const u=o.ownerDocument,c=a.getComputedStyle(o);c&&"static"===c.position&&(o.style.position="relative"),function(n){if(!n.getElementById("detectElementResize")){const i=(t||"")+".resize-triggers { "+(r||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',o=n.head||n.getElementsByTagName("head")[0],s=n.createElement("style");s.id="detectElementResize",s.type="text/css",null!=e&&s.setAttribute("nonce",e),s.styleSheet?s.styleSheet.cssText=i:s.appendChild(n.createTextNode(i)),o.appendChild(s)}}(u),o.__resizeLast__={},o.__resizeListeners__=[],(o.__resizeTriggers__=u.createElement("div")).className="resize-triggers";const d=u.createElement("div");d.className="expand-trigger",d.appendChild(u.createElement("div"));const h=u.createElement("div");h.className="contract-trigger",o.__resizeTriggers__.appendChild(d),o.__resizeTriggers__.appendChild(h),o.appendChild(o.__resizeTriggers__),s(o),o.addEventListener("scroll",l,!0),i&&(o.__resizeTriggers__.__animationListener__=function(e){e.animationName===n&&s(o)},o.__resizeTriggers__.addEventListener(i,o.__resizeTriggers__.__animationListener__))}o.__resizeListeners__.push(u)}},removeResizeListener:function(e,t){if(d)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",l,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(i,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}};class f extends i.Component{constructor(){super(...arguments),r(this,"state",{height:this.props.defaultHeight||0,width:this.props.defaultWidth||0}),r(this,"_parentNode",null),r(this,"_autoSizer",null),r(this,"_detectElementResize",null),r(this,"_onResize",()=>{const{disableHeight:e,disableWidth:t,onResize:n}=this.props;if(this._parentNode){const i=this._parentNode.getBoundingClientRect(),r=i.height||0,o=i.width||0,s=window.getComputedStyle(this._parentNode)||{},a=parseInt(s.paddingLeft,10)||0,u=parseInt(s.paddingRight,10)||0,c=parseInt(s.paddingTop,10)||0,l=parseInt(s.paddingBottom,10)||0,d=r-c-l,h=o-a-u;(!e&&this.state.height!==d||!t&&this.state.width!==h)&&(this.setState({height:r-c-l,width:o-a-u}),"function"==typeof n&&n({height:r,width:o}))}}),r(this,"_setRef",e=>{this._autoSizer=e})}componentDidMount(){const{nonce:e}=this.props;if(this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement){this._parentNode=this._autoSizer.parentNode;const t=(0,o.createDetectElementResize)(e);t.addResizeListener(this._parentNode,this._onResize),this._detectElementResize=t,this._onResize()}}componentWillUnmount(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}render(){const{children:e,defaultHeight:t,defaultWidth:n,disableHeight:r,disableWidth:o,nonce:s,onResize:a,style:u,tagName:c="div",...l}=this.props,{height:d,width:h}=this.state,p={overflow:"visible"},f={};let v=!1;return r||(0===d&&(v=!0),p.height=0,f.height=d),o||(0===h&&(v=!0),p.width=0,f.width=h),(0,i.createElement)(c,{ref:this._setRef,style:{...p,...u},...l},!v&&e(f))}}r(f,"defaultProps",{onResize:()=>{},disableHeight:!1,disableWidth:!1,style:{}});var v=f}.call(this,n(8))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.TileMap=void 0;var s=n(0),a=n(10),u=n(11),c=n(20),l=n(3);n(21);var d=function(e){function t(t){var n=e.call(this,t)||this;n.debouncedRenderMap=(0,a.debounce)(n.renderMap.bind(n),400),n.debouncedUpdateCenter=(0,a.debounce)(n.updateCenter.bind(n),50),n.debouncedHandleChange=(0,a.debounce)(n.handleChange.bind(n),50),n.handlePanZoom=function(e){if(n.props.isDraggable){var t=e.dx,i=e.dy,r=e.dz,o=n.props,s=o.size,a=o.maxSize,u=o.minSize,c=o.minX,l=o.maxX,d=o.minY,h=o.maxY,p=o.padding,f=n.state,v=f.pan,m=f.zoom,y=a/s,g=u/s,_={x:v.x-t,y:v.y-i},w=Math.max(g,Math.min(y,m-r*n.getDzZoomModifier())),x=w*s,b=(n.state.width-p)/2,z=(n.state.height-p)/2,L={x:c-b,y:h+z},E={x:l+b,y:d-z},M={x:n.state.center.x-b,y:n.state.center.y+z},T={x:n.state.center.x+b,y:n.state.center.y-z};M.x+_.x/x<L.x&&(_.x=(L.x-M.x)*x),M.y-_.y/x>L.y&&(_.y=(M.y-L.y)*x),T.x+_.x/x>E.x&&(_.x=(E.x-T.x)*x),T.y-_.y/x<E.y&&(_.y=(T.y-E.y)*x),n.setState({pan:_,zoom:w,size:x}),n.renderMap(),n.debouncedUpdateCenter()}},n.handleClick=function(e){var t=n.mouseToCoords(e.layerX,e.layerY),i=t[0],r=t[1];if(n.inBounds(i,r)){var o=n.props,s=o.onClick,a=o.onMouseUp;if(s)Date.now()-n.mousedownTimestamp<200&&(s(i,r),n.renderMap());a&&(a(i,r),n.renderMap())}},n.handleMouseDown=function(e){var t=n.props.onMouseDown;if(n.mousedownTimestamp=Date.now(),t){var i=n.mouseToCoords(e.layerX,e.layerY),r=i[0],o=i[1];if(!n.inBounds(r,o))return;t(r,o),n.renderMap()}},n.handleMouseMove=function(e){var t=e.layerX,i=e.layerY,r=n.mouseToCoords(t,i),o=r[0],s=r[1];n.inBounds(o,s)?n.hover&&n.hover.x===o&&n.hover.y===s||(n.hover={x:o,y:s},n.showPopup(o,s,i,t)):n.hidePopup()},n.handleMouseOut=function(){n.hidePopup()},n.refCanvas=function(e){n.canvas=e};var i=t.x,r=t.y,o=t.initialX,s=t.initialY,u=t.size,c=t.zoom,l={pan:{x:t.panX,y:t.panY},center:{x:null==i?o:i,y:null==r?s:r},size:c*u,zoom:c,popup:null};return n.state=n.generateState(t,l),n.oldState=n.state,n.hover=null,n.mounted=!1,n.canvas=null,n.popupTimeout=null,n}return r(t,e),t.prototype.UNSAFE_componentWillUpdate=function(e,t){var n=this.props,i=n.x,r=n.y,s=n.onCenterChange;i===e.x&&r===e.y||e.x===t.center.x&&e.y===t.center.y||(t=o(o({},t),{center:{x:e.x,y:e.y},pan:{x:0,y:0}}));var a=this.generateState(e,t),u=a.width!==this.oldState.width||a.height!==this.oldState.height||a.nw.x!==this.oldState.nw.x||a.nw.y!==this.oldState.nw.y||a.se.x!==this.oldState.se.x||a.se.y!==this.oldState.se.y||a.zoom!==this.oldState.zoom;e.x===i&&e.y===r&&this.oldState&&!u||(this.oldState=a,this.setState(a,(function(){s&&s(t.center)})),this.debouncedHandleChange())},t.prototype.UNSAFE_componentWillReceiveProps=function(e){var t=e.zoom,n=e.maxSize,i=e.minSize,r=e.size,o=n/r,s=i/r,a=Math.max(s,Math.min(o,t));a!==this.props.zoom&&a!==this.state.zoom&&this.setState({zoom:a,size:this.props.size*a})},t.prototype.componentDidUpdate=function(){this.debouncedRenderMap(),this.oldState=this.state},t.prototype.componentDidMount=function(){var e=this.props.isDraggable;this.renderMap(),this.canvas&&(e&&(this.destroy=(0,u.panzoom)(this.canvas,this.handlePanZoom)),this.canvas.addEventListener("click",this.handleClick),this.canvas.addEventListener("mousedown",this.handleMouseDown),this.canvas.addEventListener("mousemove",this.handleMouseMove),this.canvas.addEventListener("mouseout",this.handleMouseOut)),this.mounted=!0},t.prototype.componentWillUnmount=function(){this.destroy&&this.destroy(),this.canvas&&(this.canvas.removeEventListener("click",this.handleClick),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mouseout",this.handleMouseOut)),this.mounted=!1},t.prototype.generateState=function(e,t){var n=e.width,i=e.height,r=e.padding,s=t.pan,a=t.zoom,u=t.center,l=t.size,d=(0,c.getViewport)({width:n,height:i,center:u,pan:s,size:l,padding:r});return o(o({},d),{pan:s,zoom:a,center:u,size:l})},t.prototype.handleChange=function(){var e=this.props.onChange,t=this.state,n=t.nw,i=t.se,r=t.center,o=t.zoom;this.mounted&&e&&e({nw:n,se:i,center:r,zoom:o})},t.prototype.mouseToCoords=function(e,t){var n=this.props.padding,i=this.state,r=i.size,o=i.pan,s=i.center,a=i.width,u=i.height,c=(e+o.x)/r,l=(t+o.y)/r,d=(a-n-.5)/2-s.x,h=(u-n)/2+s.y;return[Math.round(c-d),Math.round(h-l)]},t.prototype.inBounds=function(e,t){var n=this.props,i=n.minX,r=n.minY,o=n.maxX,s=n.maxY;return e>=i&&e<=o&&t>=r&&t<=s},t.prototype.showPopup=function(e,t,n,i){var r=this,o=this.props,s=o.onPopup,a=o.onHover;s&&(this.hidePopup(),this.popupTimeout=+setTimeout((function(){r.mounted&&r.setState({popup:{x:e,y:t,top:n,left:i,visible:!0}},(function(){return s(r.state.popup)}))}),400)),a&&(a(e,t),this.renderMap())},t.prototype.hidePopup=function(){var e=this,t=this.props.onPopup;t&&(this.popupTimeout&&clearTimeout(this.popupTimeout),this.state.popup&&this.setState({popup:o(o({},this.state.popup),{visible:!1})},(function(){t(e.state.popup)})))},t.prototype.updateCenter=function(){var e=this.state,t=e.pan,n=e.center,i=e.size,r=this.props.onCenterChange,o=t.x%i,s=t.y%i,a={x:o,y:s},u={x:n.x+Math.floor((t.x-o)/i),y:n.y-Math.floor((t.y-s)/i)};this.setState({pan:a,center:u},(function(){r&&r(u)}))},t.prototype.renderMap=function(){if(this.canvas){var e=this.props,t=e.width,n=e.height,i=e.layers,r=e.renderMap,o=this.state,s=o.nw,a=o.se,u=o.pan,c=o.size,l=o.center;r({ctx:this.canvas.getContext("2d"),width:t,height:n,size:c,pan:u,nw:s,se:a,center:l,layers:i})}},t.prototype.getDz=function(){var e=this.state.zoom;return Math.sqrt(e)*(this.isMobile()?100:50)},t.prototype.getDzZoomModifier=function(){return this.isMobile()?.005:.01},t.prototype.isMobile=function(){return this.props.width<768},t.prototype.getCanvasClassName=function(){var e=this.props,t="react-tile-map-canvas";return e.isDraggable&&(t+=" draggable"),e.onClick&&(t+=" clickable"),t},t.prototype.handleZoomChange=function(e){var t=this.props,n=t.size,i=t.maxSize,r=t.minSize,o=this.state.zoom,s=i/n,a=r/n,u=Math.max(a,Math.min(s,o+e*this.getDzZoomModifier())),c=u*n;this.setState({zoom:u,size:c}),this.renderMap()},t.prototype.render=function(){var e=this.props,t=e.width,n=e.height,i=e.className,r=e.minSize,o=e.maxSize,a=e.withZoomControls,u=this.state.size,c={width:t,height:n},l=("react-tile-map "+i).trim();return s.createElement("div",{className:l,style:c},s.createElement("canvas",{className:this.getCanvasClassName(),width:t,height:n,ref:this.refCanvas}),a&&s.createElement("div",{className:"zoom-controls"},s.createElement("button",{onClick:this.handleZoomChange.bind(this,10),"aria-label":"Add zoom",disabled:u===o},"+"),s.createElement("button",{onClick:this.handleZoomChange.bind(this,-10),"aria-label":"Decrease zoom",disabled:u===r},"-")))},t.defaultProps={x:0,y:0,className:"",initialX:0,initialY:0,size:14,width:640,height:480,zoom:1,minSize:7,maxSize:40,minX:-150,maxX:150,minY:-150,maxY:150,panX:0,panY:0,padding:4,isDraggable:!0,withZoomControls:!1,layers:[],renderMap:l.renderMap},t}(s.PureComponent);t.TileMap=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=void 0;t.debounce=function(e,t){var n=null;return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];null!=n&&clearTimeout(n),n=setTimeout((function(){return e.apply(void 0,i)}),t)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.panzoom=void 0;var i=n(12),r=n(13),o=n(16),s=n(19);t.panzoom=function(e,t){var n=s.emitter({element:e}),a=0,u=0,c=!0,l=function(){return c=!0};e.addEventListener("mousedown",l),e.addEventListener("touchstart",l);var d=0,h=0,p=new i({source:e,update:function(i,r){c&&(c=!1,a=n[0],u=n[1]);var o={target:e,type:"mouse",dx:i-h,dy:r-d,dz:0,x:n[0],y:n[1],x0:a,y0:u};h=i,d=r,t(o)},multiplier:1,friction:.75}),f=r(e,(function(i,r,o,s){s.preventDefault(),t({target:e,type:"mouse",dx:0,dy:0,dz:r,x:n[0],y:n[1],x0:n[0],y0:n[1]})})),v=o(e),m=null;return v.on("start",(function(e){var t=v.fingers,n=t[0],i=t[1];m=[.5*i.position[0]+.5*n.position[0],.5*i.position[1]+.5*n.position[1]],p&&p.pause()})),v.on("end",(function(){m&&(m=null,p&&p.resume())})),v.on("change",(function(n,i){v.pinching&&m&&t({target:e,type:"touch",dx:0,dy:0,dz:2*-(n-i),x:m[0],y:m[1],x0:m[0],y0:m[0]})})),function(){p.destroy(),n.dispose(),v.removeAllListeners(),e.removeEventListener("wheel",f),e.removeEventListener("mousedown",l),e.removeEventListener("touchstart",l)}}},function(e,t,n){var i,r,o;r=[t,e],void 0===(o="function"==typeof(i=function(e,t){"use strict";window.addEventListener("touchmove",(function(){})),t.exports=function e(t){var r,o,s,a,u,c,l,d,h,p,f,v=t.source,m=void 0===v?document:v,y=t.update,g=t.multiplier,_=void 0===g?1:g,w=t.friction,x=void 0===w?.92:w,b=t.initialValues,z=t.boundX,L=t.boundY,E=t.bounce,M=void 0===E||E;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var T=0,C=0,S=.3*_,O=!1,P=!1,j=!1,R=!1,N=[];function A(){document.removeEventListener("touchmove",H,!!i()&&{passive:!1}),document.removeEventListener("touchend",W),document.removeEventListener("touchcancel",X),document.removeEventListener("mousemove",H,!!i()&&{passive:!1}),document.removeEventListener("mouseup",W)}function D(){y.call(m,T,C)}function k(e){if("touchmove"===e.type||"touchstart"===e.type||"touchend"===e.type){var t=e.targetTouches[0]||e.changedTouches[0];return{x:t.clientX,y:t.clientY,id:t.identifier}}return{x:e.clientX,y:e.clientY,id:null}}function F(e){var t=k(e);P||j||(P=!0,R=!1,h=t.id,u=l=t.x,c=d=t.y,N=[],Y(u,c),A(),document.addEventListener("touchmove",H,!!i()&&{passive:!1}),document.addEventListener("touchend",W),document.addEventListener("touchcancel",X),document.addEventListener("mousemove",H,!!i()&&{passive:!1}),document.addEventListener("mouseup",W))}function H(e){e.preventDefault();var t=k(e);P&&t.id===h&&(l=t.x,d=t.y,Y(u,c),O||n(B),O=!0)}function W(e){var t=k(e);P&&t.id===h&&X()}function X(){P=!1,Y(u,c),function(){var e=N[0],t=N[N.length-1],i=t.x-e.x,r=t.y-e.y,o=(t.time-e.time)/15/_;p=i/o||0,f=r/o||0;var s=q();(Math.abs(p)>1||Math.abs(f)>1||!s.inBounds)&&(R=!0,n(Z))}(),A()}function Y(e,t){for(var n=Date.now();N.length>0&&!(n-N[0].time<=100);)N.shift();N.push({x:e,y:t,time:n})}function B(){var e=l-u,t=d-c;if(T+=e*_,C+=t*_,M){var n=q();0!==n.x&&(T-=e*U(n.x)*_),0!==n.y&&(C-=t*U(n.y)*_)}else q(!0);D(),u=l,c=d,O=!1}function U(e){return 5e-6*Math.pow(e,2)+1e-4*e+.55}function q(e){var t=0,n=0;return void 0!==r&&T<r?t=r-T:void 0!==o&&T>o&&(t=o-T),void 0!==s&&C<s?n=s-C:void 0!==a&&C>a&&(n=a-C),e&&(0!==t&&(T=t>0?r:o),0!==n&&(C=n>0?s:a)),{x:t,y:n,inBounds:0===t&&0===n}}function Z(){if(R){T+=p*=x,C+=f*=x;var e=q();if(Math.abs(p)>S||Math.abs(f)>S||!e.inBounds){if(M){if(0!==e.x)if(e.x*p<=0)p+=.04*e.x;else{var t=e.x>0?2.5:-2.5;p=.11*(e.x+t)}0!==e.y&&(e.y*f<=0?f+=.04*e.y:(t=e.y>0?2.5:-2.5,f=.11*(e.y+t)))}else 0!==e.x&&(T=e.x>0?r:o,p=0),0!==e.y&&(C=e.y>0?s:a,f=0);D(),n(Z)}else R=!1}}!function(){if(!(m="string"==typeof m?document.querySelector(m):m))throw new Error("IMPETUS: source not found.");if(!y)throw new Error("IMPETUS: update function not defined.");b&&(b[0]&&(T=b[0]),b[1]&&(C=b[1]),D()),z&&(r=z[0],o=z[1]),L&&(s=L[0],a=L[1]),m.addEventListener("touchstart",F),m.addEventListener("mousedown",F)}(),this.destroy=function(){return m.removeEventListener("touchstart",F),m.removeEventListener("mousedown",F),A(),null},this.pause=function(){A(),P=!1,j=!0},this.resume=function(){j=!1},this.setValues=function(e,t){"number"==typeof e&&(T=e),"number"==typeof t&&(C=t)},this.setMultiplier=function(e){S=.3*(_=e)},this.setBoundX=function(e){r=e[0],o=e[1]},this.setBoundY=function(e){s=e[0],a=e[1]}};var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};function i(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return i=function(){return e},e}})?i.apply(t,r):i)||(e.exports=o)},function(e,t,n){"use strict";var i=n(14);e.exports=function(e,t,n){"function"==typeof e&&(n=!!t,t=e,e=window);var r=i("ex",e),o=function(e){n&&e.preventDefault();var i=e.deltaX||0,o=e.deltaY||0,s=e.deltaZ||0,a=1;switch(e.deltaMode){case 1:a=r;break;case 2:a=window.innerHeight}if(o*=a,s*=a,(i*=a)||o||s)return t(i,o,s,e)};return e.addEventListener("wheel",o),o}},function(e,t,n){"use strict";var i=n(15);e.exports=a;var r=s("in",document.body);function o(e,t){var n=i(getComputedStyle(e).getPropertyValue(t));return n[0]*a(n[1],e)}function s(e,t){var n=document.createElement("div");n.style.height="128"+e,t.appendChild(n);var i=o(n,"height")/128;return t.removeChild(n),i}function a(e,t){if(!e)return null;switch(t=t||document.body,e=(e+""||"px").trim().toLowerCase(),t!==window&&t!==document||(t=document.body),e){case"%":return t.clientHeight/100;case"ch":case"ex":return s(e,t);case"em":return o(t,"font-size");case"rem":return o(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return r;case"cm":return r/2.54;case"mm":return r/25.4;case"pt":return r/72;case"pc":return r/6;case"px":return 1}var n=i(e);if(!isNaN(n[0])&&n[1]){var u=a(n[1],t);return"number"==typeof u?n[0]*u:null}return null}},function(e,t){e.exports=function(e,t){t||(t=[0,""]),e=String(e);var n=parseFloat(e,10);return t[0]=n,t[1]=e.match(/[\d.\-\+]*\s*(.*)/)[1]||"",t}},function(e,t,n){var i=n(17),r=n(1).EventEmitter,o=n(18),s=n(2);function a(){this.position=[0,0],this.touch=null}e.exports=function(e){e=e||window;var t=new r,n=[null,null],u=0,c=0,l=!1,d=!1;return Object.defineProperties(t,{pinching:o((function(){return 2===u})),fingers:o((function(){return n}))}),p(),t.enable=p,t.disable=function(){if(!d)return;d=!1,u=0,n[0]=null,n[1]=null,c=0,l=!1,e.removeEventListener("touchstart",f,!1),e.removeEventListener("touchmove",v,!1),e.removeEventListener("touchend",m,!1),e.removeEventListener("touchcancel",m,!1)},t.indexOfTouch=h,t;function h(e){for(var t=e.identifier,i=0;i<n.length;i++)if(n[i]&&n[i].touch&&n[i].touch.identifier===t)return i;return-1}function p(){d||(d=!0,e.addEventListener("touchstart",f,!1),e.addEventListener("touchmove",v,!1),e.addEventListener("touchend",m,!1),e.addEventListener("touchcancel",m,!1))}function f(i){for(var r=0;r<i.changedTouches.length;r++){var o=i.changedTouches[r];if(-1===h(o.identifier)&&u<2){var d=0===u,p=n[0]?1:0,f=n[0]?0:1,v=new a;n[p]=v,u++,v.touch=o,s(o,e,v.position);var m=n[f]?n[f].touch:void 0;if(t.emit("place",o,m),!d){var g=y();l=!1,t.emit("start",g),c=g}}}}function v(i){for(var r=!1,o=0;o<i.changedTouches.length;o++){var a=i.changedTouches[o],l=h(a);-1!==l&&(r=!0,n[l].touch=a,s(a,e,n[l].position))}if(2===u&&r){var d=y();t.emit("change",d,c),c=d}}function m(e){for(var i=0;i<e.changedTouches.length;i++){var r=e.changedTouches[i],o=h(r);if(-1!==o){n[o]=null,u--;var s=0===o?1:0,a=n[s]?n[s].touch:void 0;t.emit("lift",r,a)}}l||2===u||(l=!0,t.emit("end"))}function y(){return u<2?0:i(n[0].position,n[1].position)}}},function(e,t){e.exports=function(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}},function(e,t){e.exports=function(e,t){return{configurable:!0,enumerable:!0,get:e,set:t}}},function(e,t,n){var i=n(2),r=n(1).EventEmitter;function o(e){var t=(e=e||{}).element||window,n=new r,o=e.position||[0,0];return!1!==e.touchstart&&(t.addEventListener("mousedown",a,!1),t.addEventListener("touchstart",s,!1)),t.addEventListener("mousemove",a,!1),t.addEventListener("touchmove",s,!1),n.position=o,n.dispose=function(){t.removeEventListener("mousemove",a,!1),t.removeEventListener("mousedown",a,!1),t.removeEventListener("touchmove",s,!1),t.removeEventListener("touchstart",s,!1)},n;function s(e){a(e.targetTouches[0])}function a(e){i(e,t,o),n.emit("move",e)}}e.exports=function(e){return o(e).position},e.exports.emitter=function(e){return o(e)}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.getViewport=void 0,t.getViewport=function(e){var t=e.width,n=e.height,r=e.center,o=e.pan,s=e.size,a=e.padding,u={width:Math.ceil(t/s+a),height:Math.ceil(n/s+a)},c=o?Math.ceil(o.x/s):0,l=o?Math.ceil(o.y/s):0,d={x:r.x-Math.ceil(u.width/2)+c,y:r.y+Math.ceil(u.height/2)-l},h={x:r.x+Math.ceil(u.width/2)+c,y:r.y-Math.ceil(u.height/2)-l},p=(h.x-d.x)*(d.y-h.y);return i(i({},u),{nw:d,se:h,area:p})}},function(e,t,n){"use strict";n.r(t)}])}));