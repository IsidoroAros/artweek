/* eslint-disable @typescript-eslint/no-explicit-any */
import { useCallback, useMemo, useState } from "react";
import { sentry } from "../utils/development/sentry";
/**
 * Use async tasks to execute async functions and return a list of task ids and a function to add a task
 * @param callback - The async function to execute
 * @param deps - The dependencies of the async function
 * @returns A tuple containing the list of task ids and a function to add a task
 */
const useAsyncTasks = (callback, deps) => {
    const [tasks, setTasks] = useState([]);
    const tasksIds = useMemo(() => tasks.map(([id]) => id), [tasks]);
    const addTask = useCallback((id, ...extra) => {
        if (tasks.find(([currentId]) => currentId === id)) {
            return;
        }
        const task = Promise.resolve()
            .then(() => callback(id, ...extra))
            .then(() => {
            setTasks((current) => current.filter(([currentId]) => currentId !== id));
        })
            .catch((err) => {
            console.error(err);
            sentry((sentry) => sentry.captureException(err));
            setTasks((current) => current.filter(([currentId]) => currentId !== id));
        });
        setTasks((current) => [...current, [id, task]]);
    }, [tasks, ...deps]);
    return [tasksIds, addTask];
};
export { useAsyncTasks };
//# sourceMappingURL=useAsyncTasks.js.map